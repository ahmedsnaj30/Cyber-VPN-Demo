# Cyber-VPN-Demo

Wireguard is a peer-to-peer VPN; it does not use the client-server model. Depending on its configuration, a peer can act as a traditional server or client. It works by creating a network interface on each peer device that acts as a tunnel. Peers authenticate each other by exchanging and validating public keys, mimicking the SSH model. Public keys are mapped with a list of IP addresses that are allowed in the tunnel. The VPN traffic is encapsulated in UDP.
 
This setup can be used as a protection against Man in the Middle attacks, surfing the web anonymously, bypassing Geo-restricted content, or allowing your colleagues who work from home to connect to the company network securely.
 
Setting up the wireguard server: A security protocol suite used to authenticate/encrypt the packets of a VPN connection to an entire network
 
Step 1: Install wireguard
```sudo apt update
sudo apt install wireguard```
 
Step 2: Configuring Wireguard:
 
Note:
The wg and wg-quick command-line tools allow you to configure and manage the WireGuard interfaces: https://linuxize.com/post/how-to-set-up-wireguard-vpn-on-ubuntu-20-04/ 
 
```wg genkey | sudo tee /etc/wireguard/privatekey | wg pubkey | sudo tee /etc/wireguard/publickey```
--> In this the keys are stored in /etc/wireguard (both private and public keys)
 
Step 3: configure the tunnel to route the VPN traffic
 
Before setting up we need private key and need to find out our public network interface (eth):
```sudo cat /etc/wireguard/privatekey
ip -o -4 route show to default | awk '{print $5}' ```
output: e.g. etho0
 
 
```sudo vim /etc/wireguard/wg0.conf```

```
[Interface]
Address = <VM address>
SaveConfig = true
ListenPort = 51820
PrivateKey = <SERVER_PRIVATE_KEY>
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o ens3 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o ens3 -j MASQUERADE
```

NOTE:
Address - A comma-separated list of v4 or v6 IP addresses for the wg0 interface. Use IPs from a range that is reserved for private networks (10.0.0.0/8, 172.16.0.0/12 or 192.168.0.0/16).
ListenPort - The listening port.
PrivateKey - A private key generated by the wg genkey command.
SaveConfig - When set to true, the current state of the interface is saved to the configuration file when shutdown.
PostUp - Command or script that is executed before bringing the interface up. In this example, weâ€™re using iptables to enable masquerading. This allows traffic to leave the server, giving the VPN clients access to the Internet.
**Make sure to replace "ens3" with the name of your public network interface.**
PostDown - command or script which is executed before bringing the interface down. The iptables rules will be removed once the interface is down.
 
 
 
Step 4: Setting permissions so that normal users can't read private key and config file
```sudo chmod 600 /etc/wireguard/{privatekey,wg0.conf}```
 
Step 5: Bring up the interface which we setup
```sudo wg-quick up wg0```
 
Step 6: check the interface state
```sudo wg show wg0```
 
Step 7: Enable Ip forwarding
```sudo nano /etc/sysctl.conf```
Then uncomment the line **net.ipv4.ip_forward=1** and **net.ipv6.conf.all.forwarding=1**
 

Check the config using 
```sudo sysctl -p```
 
Step 8: to open UDP traffic on port 51820 through firewall, since wiregruard uses UDP:
```sudo ufw allow 51820/udp```
 
Step 9: install wireguard and then add tunnel

![add tunnel](https://user-images.githubusercontent.com/70961105/194942632-f8dee4c1-933d-46db-b50d-68f64320be02.JPG)

Input the following Tunnel Settings:
```
[Interface]
PrivateKey = <CLIENT_PRIVATE_KEY>
Address = <Unknown adapter Local Area IPv4 Address> (client IP)
 
 
[Peer]
PublicKey = <SERVER_PUBLIC_KEY>
Endpoint = <SERVER_IP_ADDRESS>:51820
AllowedIPs = 0.0.0.0/0
```

Click save
 
Step 10: setup client machine on server
```sudo wg set wg0 peer CLIENT_PUBLIC_KEY allowed-ips 10.0.0.2 (Client IP)```
 
 
Step 11: connect ---- Hit the activate button.
Taadaaaaaaaaa
